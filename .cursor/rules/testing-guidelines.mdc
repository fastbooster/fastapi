---
globs: "test_*.py,*_test.py,tests/*.py"
description: "测试编写指南和最佳实践"
---

# 测试指南

## 测试结构
- 使用 `pytest` 作为测试框架
- 测试文件命名：`test_*.py` 或 `*_test.py`
- 组织测试到合适的目录结构

## 测试类型
- **单元测试**: 测试独立函数和类
- **集成测试**: 测试API端点和数据库交互
- **功能测试**: 测试完整的用户场景

## FastAPI 测试
- 使用 `TestClient` 测试API端点
- 模拟数据库和外部服务
- 测试不同的HTTP状态码和响应

## 测试数据
- 使用工厂函数创建测试数据
- 使用测试数据库（SQLite内存数据库）
- 在测试之间清理数据

## 断言和验证
- 使用明确的断言消息
- 测试正常情况和边界情况
- 验证错误处理和异常

## 测试覆盖率
- 维持高测试覆盖率（目标 > 80%）
- 使用 `pytest-cov` 生成覆盖率报告
- 专注于测试核心业务逻辑
